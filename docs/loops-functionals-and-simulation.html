<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>14 Loops, Functionals, and Simulation | R Textbook</title>
  <meta name="description" content="This is the ‘organic’ textbook created by our class discussions and exercises.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="14 Loops, Functionals, and Simulation | R Textbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the ‘organic’ textbook created by our class discussions and exercises." />
  <meta name="github-repo" content="iancero/r-textbook-spring2019" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Loops, Functionals, and Simulation | R Textbook" />
  
  <meta name="twitter:description" content="This is the ‘organic’ textbook created by our class discussions and exercises." />
  

<meta name="author" content="Ian Cero’s CSP 518 Class">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="functionals.html">
<link rel="next" href="strings-and-text.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="basic-r.html"><a href="basic-r.html"><i class="fa fa-check"></i><b>2</b> Basic R</a><ul>
<li class="chapter" data-level="2.1" data-path="basic-r.html"><a href="basic-r.html#writing-in-r-and-rmarkdown"><i class="fa fa-check"></i><b>2.1</b> Writing in R and Rmarkdown</a><ul>
<li class="chapter" data-level="2.1.1" data-path="basic-r.html"><a href="basic-r.html#chatting-with-r"><i class="fa fa-check"></i><b>2.1.1</b> Chatting with R</a></li>
<li class="chapter" data-level="2.1.2" data-path="basic-r.html"><a href="basic-r.html#rmarkdown-tricks"><i class="fa fa-check"></i><b>2.1.2</b> Rmarkdown tricks</a></li>
<li class="chapter" data-level="2.1.3" data-path="basic-r.html"><a href="basic-r.html#code-blocks"><i class="fa fa-check"></i><b>2.1.3</b> Code blocks</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="basic-r.html"><a href="basic-r.html#variables"><i class="fa fa-check"></i><b>2.2</b> Variables</a><ul>
<li class="chapter" data-level="2.2.1" data-path="basic-r.html"><a href="basic-r.html#the-assignment-operator"><i class="fa fa-check"></i><b>2.2.1</b> The assignment operator</a></li>
<li class="chapter" data-level="2.2.2" data-path="basic-r.html"><a href="basic-r.html#numerics"><i class="fa fa-check"></i><b>2.2.2</b> Numerics</a></li>
<li class="chapter" data-level="2.2.3" data-path="basic-r.html"><a href="basic-r.html#characters"><i class="fa fa-check"></i><b>2.2.3</b> Characters</a></li>
<li class="chapter" data-level="2.2.4" data-path="basic-r.html"><a href="basic-r.html#booleans"><i class="fa fa-check"></i><b>2.2.4</b> Booleans</a></li>
<li class="chapter" data-level="2.2.5" data-path="basic-r.html"><a href="basic-r.html#special-types"><i class="fa fa-check"></i><b>2.2.5</b> Special types</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="basic-r.html"><a href="basic-r.html#vectors"><i class="fa fa-check"></i><b>2.3</b> Vectors</a></li>
<li class="chapter" data-level="2.4" data-path="basic-r.html"><a href="basic-r.html#lists"><i class="fa fa-check"></i><b>2.4</b> Lists</a></li>
<li class="chapter" data-level="2.5" data-path="basic-r.html"><a href="basic-r.html#dataframes"><i class="fa fa-check"></i><b>2.5</b> Dataframes</a><ul>
<li class="chapter" data-level="2.5.1" data-path="basic-r.html"><a href="basic-r.html#construction"><i class="fa fa-check"></i><b>2.5.1</b> Construction</a></li>
<li class="chapter" data-level="2.5.2" data-path="basic-r.html"><a href="basic-r.html#built-in-dataframes"><i class="fa fa-check"></i><b>2.5.2</b> Built-in dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="basic-r.html"><a href="basic-r.html#functions"><i class="fa fa-check"></i><b>2.6</b> Functions</a><ul>
<li class="chapter" data-level="2.6.1" data-path="basic-r.html"><a href="basic-r.html#getting-help"><i class="fa fa-check"></i><b>2.6.1</b> Getting help</a></li>
<li class="chapter" data-level="2.6.2" data-path="basic-r.html"><a href="basic-r.html#function-parameters"><i class="fa fa-check"></i><b>2.6.2</b> Function parameters</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="basic-r.html"><a href="basic-r.html#packages"><i class="fa fa-check"></i><b>2.7</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>3</b> Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="visualization.html"><a href="visualization.html#base-r"><i class="fa fa-check"></i><b>3.1</b> Base R</a></li>
<li class="chapter" data-level="3.2" data-path="visualization.html"><a href="visualization.html#ggplot"><i class="fa fa-check"></i><b>3.2</b> <code>ggplot</code></a><ul>
<li class="chapter" data-level="3.2.1" data-path="visualization.html"><a href="visualization.html#blank-ggplot-plot"><i class="fa fa-check"></i><b>3.2.1</b> Blank ggplot plot</a></li>
<li class="chapter" data-level="3.2.2" data-path="visualization.html"><a href="visualization.html#geoms"><i class="fa fa-check"></i><b>3.2.2</b> Geoms</a></li>
<li class="chapter" data-level="3.2.3" data-path="visualization.html"><a href="visualization.html#stat-functions"><i class="fa fa-check"></i><b>3.2.3</b> Stat Functions</a></li>
<li class="chapter" data-level="3.2.4" data-path="visualization.html"><a href="visualization.html#themes"><i class="fa fa-check"></i><b>3.2.4</b> Themes</a></li>
<li class="chapter" data-level="3.2.5" data-path="visualization.html"><a href="visualization.html#labels"><i class="fa fa-check"></i><b>3.2.5</b> Labels</a></li>
<li class="chapter" data-level="3.2.6" data-path="visualization.html"><a href="visualization.html#scales"><i class="fa fa-check"></i><b>3.2.6</b> Scales</a></li>
<li class="chapter" data-level="3.2.7" data-path="visualization.html"><a href="visualization.html#saving-your-plot"><i class="fa fa-check"></i><b>3.2.7</b> Saving your plot**</a></li>
<li class="chapter" data-level="3.2.8" data-path="visualization.html"><a href="visualization.html#facets"><i class="fa fa-check"></i><b>3.2.8</b> Facets</a></li>
<li class="chapter" data-level="3.2.9" data-path="visualization.html"><a href="visualization.html#where-to-learn-more"><i class="fa fa-check"></i><b>3.2.9</b> Where to learn more</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="functions-1.html"><a href="functions-1.html"><i class="fa fa-check"></i><b>4</b> Functions</a><ul>
<li class="chapter" data-level="4.1" data-path="functions-1.html"><a href="functions-1.html#basic-example"><i class="fa fa-check"></i><b>4.1</b> Basic Example</a></li>
<li class="chapter" data-level="4.2" data-path="functions-1.html"><a href="functions-1.html#anatomy-of-an-r-function"><i class="fa fa-check"></i><b>4.2</b> Anatomy of an R function</a></li>
<li class="chapter" data-level="4.3" data-path="functions-1.html"><a href="functions-1.html#base-r-functions"><i class="fa fa-check"></i><b>4.3</b> Base R functions</a><ul>
<li class="chapter" data-level="4.3.1" data-path="functions-1.html"><a href="functions-1.html#scoping"><i class="fa fa-check"></i><b>4.3.1</b> Scoping</a></li>
<li class="chapter" data-level="4.3.2" data-path="functions-1.html"><a href="functions-1.html#conditional-execution"><i class="fa fa-check"></i><b>4.3.2</b> Conditional execution</a></li>
<li class="chapter" data-level="4.3.3" data-path="functions-1.html"><a href="functions-1.html#the-return-command"><i class="fa fa-check"></i><b>4.3.3</b> the <code>return()</code> command</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="functions-1.html"><a href="functions-1.html#pipes"><i class="fa fa-check"></i><b>4.4</b> Pipes</a><ul>
<li class="chapter" data-level="4.4.1" data-path="functions-1.html"><a href="functions-1.html#basic-usage"><i class="fa fa-check"></i><b>4.4.1</b> Basic usage</a></li>
<li class="chapter" data-level="4.4.2" data-path="functions-1.html"><a href="functions-1.html#sending-the-lhs-to-another-parameter"><i class="fa fa-check"></i><b>4.4.2</b> Sending the LHS to another parameter</a></li>
<li class="chapter" data-level="4.4.3" data-path="functions-1.html"><a href="functions-1.html#convenient-magrittr-functions"><i class="fa fa-check"></i><b>4.4.3</b> Convenient magrittr functions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="functions-1.html"><a href="functions-1.html#more-talk-about-the-help-files"><i class="fa fa-check"></i><b>4.5</b> More talk about the help files</a></li>
<li class="chapter" data-level="4.6" data-path="functions-1.html"><a href="functions-1.html#functions-from-other-packages"><i class="fa fa-check"></i><b>4.6</b> Functions from other packages</a></li>
<li class="chapter" data-level="4.7" data-path="functions-1.html"><a href="functions-1.html#section"><i class="fa fa-check"></i><b>4.7</b> </a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dataframes-1.html"><a href="dataframes-1.html"><i class="fa fa-check"></i><b>5</b> Dataframes</a><ul>
<li class="chapter" data-level="5.1" data-path="dataframes-1.html"><a href="dataframes-1.html#storing-rectangular-data"><i class="fa fa-check"></i><b>5.1</b> Storing rectangular data</a><ul>
<li class="chapter" data-level="5.1.1" data-path="dataframes-1.html"><a href="dataframes-1.html#making-dataframes"><i class="fa fa-check"></i><b>5.1.1</b> Making dataframes</a></li>
<li class="chapter" data-level="5.1.2" data-path="dataframes-1.html"><a href="dataframes-1.html#strings-as-factors"><i class="fa fa-check"></i><b>5.1.2</b> Strings as factors</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dataframes-1.html"><a href="dataframes-1.html#accessing-data-from-a-dataframe"><i class="fa fa-check"></i><b>5.2</b> Accessing data from a dataframe</a><ul>
<li class="chapter" data-level="5.2.1" data-path="dataframes-1.html"><a href="dataframes-1.html#basic-framework"><i class="fa fa-check"></i><b>5.2.1</b> Basic framework</a></li>
<li class="chapter" data-level="5.2.2" data-path="dataframes-1.html"><a href="dataframes-1.html#using-string-column-names"><i class="fa fa-check"></i><b>5.2.2</b> Using string column names</a></li>
<li class="chapter" data-level="5.2.3" data-path="dataframes-1.html"><a href="dataframes-1.html#using-the-operator"><i class="fa fa-check"></i><b>5.2.3</b> Using the <code>$</code> operator</a></li>
<li class="chapter" data-level="5.2.4" data-path="dataframes-1.html"><a href="dataframes-1.html#using-booleans"><i class="fa fa-check"></i><b>5.2.4</b> Using booleans</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="dataframes-1.html"><a href="dataframes-1.html#manupilating-data"><i class="fa fa-check"></i><b>5.3</b> Manupilating data</a></li>
<li class="chapter" data-level="5.4" data-path="dataframes-1.html"><a href="dataframes-1.html#using-dplyr-pipelines"><i class="fa fa-check"></i><b>5.4</b> Using <code>dplyr</code> pipelines</a><ul>
<li class="chapter" data-level="5.4.1" data-path="dataframes-1.html"><a href="dataframes-1.html#how-do-these-functions-work"><i class="fa fa-check"></i><b>5.4.1</b> How do these functions work?</a></li>
<li class="chapter" data-level="5.4.2" data-path="dataframes-1.html"><a href="dataframes-1.html#group_by"><i class="fa fa-check"></i><b>5.4.2</b> <code>group_by()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="dataframes-1.html"><a href="dataframes-1.html#dplyr-pipelines-with-the-magrittr"><i class="fa fa-check"></i><b>5.5</b> <code>dplyr</code> pipelines with the <code>magrittr</code> <code>%&gt;%</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="local-data-import-and-export.html"><a href="local-data-import-and-export.html"><i class="fa fa-check"></i><b>6</b> Local Data Import and Export</a><ul>
<li class="chapter" data-level="6.1" data-path="local-data-import-and-export.html"><a href="local-data-import-and-export.html#basic-exportation-to-a-.csv-file"><i class="fa fa-check"></i><b>6.1</b> Basic exportation to a <code>.csv</code> file</a><ul>
<li class="chapter" data-level="6.1.1" data-path="local-data-import-and-export.html"><a href="local-data-import-and-export.html#other-options"><i class="fa fa-check"></i><b>6.1.1</b> Other options</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="local-data-import-and-export.html"><a href="local-data-import-and-export.html#reading-in-rectangular-data"><i class="fa fa-check"></i><b>6.2</b> Reading in rectangular data</a><ul>
<li class="chapter" data-level="6.2.1" data-path="local-data-import-and-export.html"><a href="local-data-import-and-export.html#traditional-importation"><i class="fa fa-check"></i><b>6.2.1</b> Traditional importation</a></li>
<li class="chapter" data-level="6.2.2" data-path="local-data-import-and-export.html"><a href="local-data-import-and-export.html#importation-options-to-know-about"><i class="fa fa-check"></i><b>6.2.2</b> Importation options to know about</a></li>
<li class="chapter" data-level="6.2.3" data-path="local-data-import-and-export.html"><a href="local-data-import-and-export.html#consider-the-readr-package"><i class="fa fa-check"></i><b>6.2.3</b> Consider the <code>readr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="local-data-import-and-export.html"><a href="local-data-import-and-export.html#importing-data-from-other-programs"><i class="fa fa-check"></i><b>6.3</b> Importing data from other programs</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-joins.html"><a href="data-joins.html"><i class="fa fa-check"></i><b>7</b> Data joins</a><ul>
<li class="chapter" data-level="7.1" data-path="data-joins.html"><a href="data-joins.html#left-joins"><i class="fa fa-check"></i><b>7.1</b> Left joins</a></li>
<li class="chapter" data-level="7.2" data-path="data-joins.html"><a href="data-joins.html#inner-joins"><i class="fa fa-check"></i><b>7.2</b> Inner joins</a></li>
<li class="chapter" data-level="7.3" data-path="data-joins.html"><a href="data-joins.html#full-joins"><i class="fa fa-check"></i><b>7.3</b> Full joins</a></li>
<li class="chapter" data-level="7.4" data-path="data-joins.html"><a href="data-joins.html#anti-joins"><i class="fa fa-check"></i><b>7.4</b> Anti joins</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="reshaping-data-with-tidyr.html"><a href="reshaping-data-with-tidyr.html"><i class="fa fa-check"></i><b>8</b> Reshaping data with <code>tidyr</code></a><ul>
<li class="chapter" data-level="8.1" data-path="reshaping-data-with-tidyr.html"><a href="reshaping-data-with-tidyr.html#turning-long-data-into-wide"><i class="fa fa-check"></i><b>8.1</b> Turning long data into wide</a></li>
<li class="chapter" data-level="8.2" data-path="reshaping-data-with-tidyr.html"><a href="reshaping-data-with-tidyr.html#turning-wide-data-into-long"><i class="fa fa-check"></i><b>8.2</b> Turning wide data into long</a></li>
<li class="chapter" data-level="8.3" data-path="reshaping-data-with-tidyr.html"><a href="reshaping-data-with-tidyr.html#other-examples-we-talked-about"><i class="fa fa-check"></i><b>8.3</b> Other examples we talked about</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="regression-models.html"><a href="regression-models.html"><i class="fa fa-check"></i><b>9</b> Regression Models</a><ul>
<li class="chapter" data-level="9.1" data-path="regression-models.html"><a href="regression-models.html#simulating-fake-data"><i class="fa fa-check"></i><b>9.1</b> Simulating fake data</a></li>
<li class="chapter" data-level="9.2" data-path="regression-models.html"><a href="regression-models.html#fitting-regression-models"><i class="fa fa-check"></i><b>9.2</b> Fitting regression models</a><ul>
<li class="chapter" data-level="9.2.1" data-path="regression-models.html"><a href="regression-models.html#linear-regression"><i class="fa fa-check"></i><b>9.2.1</b> Linear regression</a></li>
<li class="chapter" data-level="9.2.2" data-path="regression-models.html"><a href="regression-models.html#logistic-regression"><i class="fa fa-check"></i><b>9.2.2</b> Logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="regression-models.html"><a href="regression-models.html#other-ways-of-viewing-the-output"><i class="fa fa-check"></i><b>9.3</b> Other ways of viewing the output</a><ul>
<li class="chapter" data-level="9.3.1" data-path="regression-models.html"><a href="regression-models.html#glance"><i class="fa fa-check"></i><b>9.3.1</b> <code>glance()</code></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="regression-models.html"><a href="regression-models.html#fitting-multiple-regressions-simultaneously"><i class="fa fa-check"></i><b>9.4</b> Fitting multiple regressions simultaneously</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="regression-models-1.html"><a href="regression-models-1.html"><i class="fa fa-check"></i><b>10</b> Regression Models</a><ul>
<li class="chapter" data-level="10.1" data-path="regression-models-1.html"><a href="regression-models-1.html#simulating-fake-data-1"><i class="fa fa-check"></i><b>10.1</b> Simulating fake data</a></li>
<li class="chapter" data-level="10.2" data-path="regression-models-1.html"><a href="regression-models-1.html#fitting-regression-models-1"><i class="fa fa-check"></i><b>10.2</b> Fitting regression models</a><ul>
<li class="chapter" data-level="10.2.1" data-path="regression-models-1.html"><a href="regression-models-1.html#linear-regression-1"><i class="fa fa-check"></i><b>10.2.1</b> Linear regression</a></li>
<li class="chapter" data-level="10.2.2" data-path="regression-models-1.html"><a href="regression-models-1.html#logistic-regression-1"><i class="fa fa-check"></i><b>10.2.2</b> Logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="regression-models-1.html"><a href="regression-models-1.html#other-ways-of-viewing-the-output-1"><i class="fa fa-check"></i><b>10.3</b> Other ways of viewing the output</a><ul>
<li class="chapter" data-level="10.3.1" data-path="regression-models-1.html"><a href="regression-models-1.html#glance-1"><i class="fa fa-check"></i><b>10.3.1</b> <code>glance()</code></a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="regression-models-1.html"><a href="regression-models-1.html#fitting-multiple-regressions-simultaneously-1"><i class="fa fa-check"></i><b>10.4</b> Fitting multiple regressions simultaneously</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html"><i class="fa fa-check"></i><b>11</b> ANOVA and other tests</a><ul>
<li class="chapter" data-level="11.1" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#t-tests"><i class="fa fa-check"></i><b>11.1</b> <em>t</em>-Tests</a></li>
<li class="chapter" data-level="11.2" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#correlation"><i class="fa fa-check"></i><b>11.2</b> Correlation</a><ul>
<li class="chapter" data-level="11.2.1" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#rank-correlations"><i class="fa fa-check"></i><b>11.2.1</b> Rank correlations</a></li>
<li class="chapter" data-level="11.2.2" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#significance-testing"><i class="fa fa-check"></i><b>11.2.2</b> Significance testing</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#anova"><i class="fa fa-check"></i><b>11.3</b> ANOVA</a><ul>
<li class="chapter" data-level="11.3.1" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#post-hoc-testing"><i class="fa fa-check"></i><b>11.3.1</b> Post hoc testing</a></li>
<li class="chapter" data-level="11.3.2" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#two-factors"><i class="fa fa-check"></i><b>11.3.2</b> Two-factors</a></li>
<li class="chapter" data-level="11.3.3" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#p-values"><i class="fa fa-check"></i><b>11.3.3</b> P-values</a></li>
<li class="chapter" data-level="11.3.4" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#interactions"><i class="fa fa-check"></i><b>11.3.4</b> Interactions</a></li>
<li class="chapter" data-level="11.3.5" data-path="anova-and-other-tests.html"><a href="anova-and-other-tests.html#plots"><i class="fa fa-check"></i><b>11.3.5</b> Plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="structural-equation-modeling.html"><a href="structural-equation-modeling.html"><i class="fa fa-check"></i><b>12</b> Structural Equation Modeling</a><ul>
<li class="chapter" data-level="12.1" data-path="structural-equation-modeling.html"><a href="structural-equation-modeling.html#confirmatory-factor-analysis"><i class="fa fa-check"></i><b>12.1</b> Confirmatory Factor Analysis</a><ul>
<li class="chapter" data-level="12.1.1" data-path="structural-equation-modeling.html"><a href="structural-equation-modeling.html#cfa-syntax"><i class="fa fa-check"></i><b>12.1.1</b> CFA syntax</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="structural-equation-modeling.html"><a href="structural-equation-modeling.html#full-structural-equation-models"><i class="fa fa-check"></i><b>12.2</b> Full Structural Equation Models</a></li>
<li class="chapter" data-level="12.3" data-path="structural-equation-modeling.html"><a href="structural-equation-modeling.html#additional-tricks"><i class="fa fa-check"></i><b>12.3</b> Additional tricks</a><ul>
<li class="chapter" data-level="12.3.1" data-path="structural-equation-modeling.html"><a href="structural-equation-modeling.html#missing-data"><i class="fa fa-check"></i><b>12.3.1</b> Missing data</a></li>
<li class="chapter" data-level="12.3.2" data-path="structural-equation-modeling.html"><a href="structural-equation-modeling.html#robus-estimators"><i class="fa fa-check"></i><b>12.3.2</b> Robus estimators</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>13</b> Functionals</a></li>
<li class="chapter" data-level="14" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html"><i class="fa fa-check"></i><b>14</b> Loops, Functionals, and Simulation</a><ul>
<li class="chapter" data-level="14.1" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html#loops"><i class="fa fa-check"></i><b>14.1</b> Loops</a><ul>
<li class="chapter" data-level="14.1.1" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html#when-should-i-use-for-loops"><i class="fa fa-check"></i><b>14.1.1</b> When should I use for loops?</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html#functionals-1"><i class="fa fa-check"></i><b>14.2</b> Functionals</a><ul>
<li class="chapter" data-level="14.2.1" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html#the-base-r-way"><i class="fa fa-check"></i><b>14.2.1</b> The base R way</a></li>
<li class="chapter" data-level="14.2.2" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html#sapply-and-unlisting"><i class="fa fa-check"></i><b>14.2.2</b> <code>sapply()</code> and Unlisting</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html#the-tidyverse-functionals"><i class="fa fa-check"></i><b>14.3</b> The tidyverse functionals</a></li>
<li class="chapter" data-level="14.4" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html#simulation"><i class="fa fa-check"></i><b>14.4</b> Simulation</a><ul>
<li class="chapter" data-level="14.4.1" data-path="loops-functionals-and-simulation.html"><a href="loops-functionals-and-simulation.html#a-worked-example"><i class="fa fa-check"></i><b>14.4.1</b> A worked example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="strings-and-text.html"><a href="strings-and-text.html"><i class="fa fa-check"></i><b>15</b> Strings and text</a><ul>
<li class="chapter" data-level="15.1" data-path="strings-and-text.html"><a href="strings-and-text.html#string-matching-and-substitution"><i class="fa fa-check"></i><b>15.1</b> String matching and substitution</a><ul>
<li class="chapter" data-level="15.1.1" data-path="strings-and-text.html"><a href="strings-and-text.html#fixed-true"><i class="fa fa-check"></i><b>15.1.1</b> <code>fixed = TRUE</code></a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="strings-and-text.html"><a href="strings-and-text.html#string-interpolation"><i class="fa fa-check"></i><b>15.2</b> String interpolation</a></li>
<li class="chapter" data-level="15.3" data-path="strings-and-text.html"><a href="strings-and-text.html#sentiment-analysis"><i class="fa fa-check"></i><b>15.3</b> Sentiment analysis</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="internet-data.html"><a href="internet-data.html"><i class="fa fa-check"></i><b>16</b> Internet data</a><ul>
<li class="chapter" data-level="16.1" data-path="internet-data.html"><a href="internet-data.html#api-background"><i class="fa fa-check"></i><b>16.1</b> API Background</a></li>
<li class="chapter" data-level="16.2" data-path="internet-data.html"><a href="internet-data.html#connecting-to-an-api"><i class="fa fa-check"></i><b>16.2</b> Connecting to an API</a></li>
<li class="chapter" data-level="16.3" data-path="internet-data.html"><a href="internet-data.html#working-with-api-data"><i class="fa fa-check"></i><b>16.3</b> Working with API data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Textbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="loops-functionals-and-simulation" class="section level1">
<h1><span class="header-section-number">14</span> Loops, Functionals, and Simulation</h1>
<p>In this chapter, we cover three seperate topics: loops, functionals, and simulation. Although they are distinct from one another, we’ll cover them together because they are quite useful in combination. The chapter outline is as follows.</p>
<ol style="list-style-type: decimal">
<li>Loops</li>
<li>Functionals</li>
<li>Simulation</li>
</ol>
<div id="loops" class="section level2">
<h2><span class="header-section-number">14.1</span> Loops</h2>
<p>As you may have anticipated from your data manipulation tasks so far, performing the same task over and over again on new pieces of data is a common problem. R makes a lot of this easy for us by assuming that whenever we are working with a vector of items that we want to repeat operations for all of those items. For example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_vec &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">:</span><span class="dv">15</span>

my_vec<span class="op">^</span><span class="dv">2</span></code></pre></div>
<pre><code>## [1] 100 121 144 169 196 225</code></pre>
<p>Sometimes, though, we want more control than to do <em>exactly</em> the same thing to each item. Maybe we want to get cumulative sums, which require us to know what the other values in the vector are. For example, consider a vector of monthly profits.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">314159</span>)

monthly_profits &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dv">12</span>, <span class="dt">lambda =</span> <span class="dv">100</span>) <span class="co"># 12 months with $100 average</span>

monthly_profits</code></pre></div>
<pre><code>##  [1]  92  97 103  96  96  92  84  83  94  83  95 111</code></pre>
<p>I can do that with a <strong>for loop</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cumulative_profits &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>){
  cumulative_profits &lt;-<span class="st"> </span>cumulative_profits <span class="op">+</span><span class="st"> </span>monthly_profits[m]
  
  <span class="kw">print</span>(cumulative_profits)
}</code></pre></div>
<pre><code>## [1] 92
## [1] 189
## [1] 292
## [1] 388
## [1] 484
## [1] 576
## [1] 660
## [1] 743
## [1] 837
## [1] 920
## [1] 1015
## [1] 1126</code></pre>
<p>This type of loop consists of three parts:</p>
<ol style="list-style-type: decimal">
<li>The index variable, <code>m</code> (you can name it whatever you want)</li>
<li>The vector <code>m</code> grabs its values from (here, <code>1:12</code>, but can be whatever you want)</li>
<li>The commands to perform for each increment of <code>m</code> (everything between the <code>{}</code>)</li>
</ol>
<p>In this case, our #3 is a little trickier because we created a variable outside the loop (<code>cumulative_profits</code>), which we then modified inside the loop. We did that here to demonstrate the power of for loops - they give a lot of control.</p>
<div id="when-should-i-use-for-loops" class="section level3">
<h3><span class="header-section-number">14.1.1</span> When should I use for loops?</h3>
<p>Generally, you should avoid them in R. The reason is that they require several lines of code to perform the same task that specialized R functions already perform in one. For example, in our cumulative profits case above, R has a special function <code>cumsum()</code> that can already to this same task for us.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cumsum</span>(monthly_profits)</code></pre></div>
<pre><code>##  [1]   92  189  292  388  484  576  660  743  837  920 1015 1126</code></pre>
<p>That’s much easier to read - and we don’t have to worry about recoding it every time. There are other reasons to try to avoid for loops if you can, including the fact that <em>sometimes</em> (though not all the time) they can be memory inefficient. This used to be a bigger deal a few decades ago, but with modern computers will only matter if you are working on something that has millions of cases (i.e., “big” data).</p>
<p>HOWEVER! There is one case when you will <em>need</em> to use a for loop, when you need to modify something <em>in place</em>. For those special cases, [see this resource]((<a href="http://adv-r.had.co.nz/Functionals.html#functionals-not" class="uri">http://adv-r.had.co.nz/Functionals.html#functionals-not</a>).</p>
</div>
</div>
<div id="functionals-1" class="section level2">
<h2><span class="header-section-number">14.2</span> Functionals</h2>
<p>Functionals are functions that apply other functions for you - essentially, they are automated loops. With a functional, you don’t have to think about your indexing variable or the vector it draws its values from, you just need to keep track of the function you want applied to everything. Functionals existed in base R, but there is also now a tidyverse version of them. We’ll cover both!</p>
<div id="the-base-r-way" class="section level3">
<h3><span class="header-section-number">14.2.1</span> The base R way</h3>
<p>Functionals in R come from the “apply” family, so they all have names that end in “-apply.” The most commonly used is <code>lapply()</code> (pronounced “ell-apply”). This functional takes a list or vector as its first argument and a function to apply to each element of the list as its second argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">double_n_square &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  (<span class="dv">2</span><span class="op">*</span>x)<span class="op">^</span><span class="dv">2</span>
}

my_vals &lt;-<span class="st"> </span><span class="dv">20</span><span class="op">:</span><span class="dv">25</span>

<span class="kw">lapply</span>(my_vals, double_n_square) <span class="co"># note I don&#39;t need () for the function name</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1600
## 
## [[2]]
## [1] 1764
## 
## [[3]]
## [1] 1936
## 
## [[4]]
## [1] 2116
## 
## [[5]]
## [1] 2304
## 
## [[6]]
## [1] 2500</code></pre>
<p>Above, we used a custom function, but you can also use a built-in R function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(my_vals, sqrt)</code></pre></div>
<pre><code>## [[1]]
## [1] 4.472136
## 
## [[2]]
## [1] 4.582576
## 
## [[3]]
## [1] 4.690416
## 
## [[4]]
## [1] 4.795832
## 
## [[5]]
## [1] 4.898979
## 
## [[6]]
## [1] 5</code></pre>
<p>Also, we can use an “anonymous” function. This is a function without a name that we feed to <code>lapply()</code>. Once the <code>lapply()</code> operation is over, our function disappears.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(my_vals, <span class="cf">function</span>(val){
  val<span class="op">/</span><span class="dv">3</span>
})</code></pre></div>
<pre><code>## [[1]]
## [1] 6.666667
## 
## [[2]]
## [1] 7
## 
## [[3]]
## [1] 7.333333
## 
## [[4]]
## [1] 7.666667
## 
## [[5]]
## [1] 8
## 
## [[6]]
## [1] 8.333333</code></pre>
<p>Here, we used a simply case where an anonymous function probably wasn’t necessary. But you can imagine more complicated situations where it would be helpful. For example, if I wanted to square all the odd values and take the square root of all the even ones.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(my_vals, <span class="cf">function</span>(val){
  is_odd &lt;-<span class="st"> </span>val <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>
  
  <span class="cf">if</span>(is_odd){
    val &lt;-<span class="st"> </span>val<span class="op">^</span><span class="dv">2</span>
  } <span class="cf">else</span> {
    val &lt;-<span class="st"> </span><span class="kw">sqrt</span>(val)
  }
  
  val
})</code></pre></div>
<pre><code>## [[1]]
## [1] 4.472136
## 
## [[2]]
## [1] 441
## 
## [[3]]
## [1] 4.690416
## 
## [[4]]
## [1] 529
## 
## [[5]]
## [1] 4.898979
## 
## [[6]]
## [1] 625</code></pre>
</div>
<div id="sapply-and-unlisting" class="section level3">
<h3><span class="header-section-number">14.2.2</span> <code>sapply()</code> and Unlisting</h3>
<p>Note that what <code>lapply()</code> gives us is actually a list, no a vector. If we want our output to go back to a simple vector, we can either use <code>sapply()</code> (“simple apply”) or <code>unlist()</code> after a <code>lapply()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(my_vals, <span class="cf">function</span>(val){
  is_odd &lt;-<span class="st"> </span>val <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>
  
  <span class="cf">if</span>(is_odd){
    val &lt;-<span class="st"> </span>val<span class="op">^</span><span class="dv">2</span>
  } <span class="cf">else</span> {
    val &lt;-<span class="st"> </span><span class="kw">sqrt</span>(val)
  }
  
  val
})</code></pre></div>
<pre><code>## [1]   4.472136 441.000000   4.690416 529.000000   4.898979 625.000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw">lapply</span>(my_vals, <span class="cf">function</span>(val){
  is_odd &lt;-<span class="st"> </span>val <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>
  
  <span class="cf">if</span>(is_odd){
    val &lt;-<span class="st"> </span>val<span class="op">^</span><span class="dv">2</span>
  } <span class="cf">else</span> {
    val &lt;-<span class="st"> </span><span class="kw">sqrt</span>(val)
  }
  
  val
})

<span class="kw">unlist</span>(output)</code></pre></div>
<pre><code>## [1]   4.472136 441.000000   4.690416 529.000000   4.898979 625.000000</code></pre>
</div>
</div>
<div id="the-tidyverse-functionals" class="section level2">
<h2><span class="header-section-number">14.3</span> The tidyverse functionals</h2>
<p>The tidyverse also includes its own set of functionals, which are all some version of <code>map()</code>. These are nice because they use a special notation that allows you to refer to each element of your vector with a <code>~ .x</code>. The <code>~</code> says “look for the <code>.x</code>”, the <code>.x</code> says “this is value I am currently working on”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)

my_vals &lt;-<span class="st"> </span><span class="dv">100</span><span class="op">:</span><span class="dv">105</span>

<span class="kw">map</span>(my_vals, <span class="op">~</span><span class="st"> </span>.x<span class="op">/</span><span class="dv">2</span>)</code></pre></div>
<pre><code>## [[1]]
## [1] 50
## 
## [[2]]
## [1] 50.5
## 
## [[3]]
## [1] 51
## 
## [[4]]
## [1] 51.5
## 
## [[5]]
## [1] 52
## 
## [[6]]
## [1] 52.5</code></pre>
<p>If I know all of my outputs are going to be a particular type (e.g., logical, character, or double), then I can use the special <code>map_lgl()</code>, <code>map_chr()</code>, and <code>map_dbl()</code> functions to return a vector right away.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(my_vals, <span class="op">~</span><span class="st"> </span>.x<span class="op">/</span><span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 50.0 50.5 51.0 51.5 52.0 52.5</code></pre>
<p>I can also use <code>map()</code> like <code>lapply()</code> if I want, I just remove the <code>~ .x</code> notation and replace it with a function name, like above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(my_vals, sqrt)</code></pre></div>
<pre><code>## [1] 10.00000 10.04988 10.09950 10.14889 10.19804 10.24695</code></pre>
</div>
<div id="simulation" class="section level2">
<h2><span class="header-section-number">14.4</span> Simulation</h2>
<p>The field of statistics is premised on one primary insight: even in a world of randomness, I generally know more than nothing. With that insight in mind, the field is dedicated to quantifying what kinds of things are knowable, and to what degree, when there is significant uncertainty at play. Sometimes, this relatively easy to do with a known distribution. For example, if we know a distribution is Normal, then we also know that values near the mean will be much more common than values farther away from the mean - and we can quantify <em>how much</em> more common.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">curve</span>(<span class="kw">dnorm</span>(x), <span class="dt">from =</span> <span class="op">-</span><span class="dv">3</span>, <span class="dt">to =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-207-1.png" width="672" /></p>
<p>Other times, quantifying how likely something is to happen can be so complicated that a closed-form formula simply does not exist - or if it did exist, it would be too difficult to work with. In those cases, we run a simulation.</p>
<div id="a-worked-example" class="section level3">
<h3><span class="header-section-number">14.4.1</span> A worked example</h3>
<p>In what follows, we will explore what happens when there are true quadratic effects in the population, but we mistakenly model an interaction instead (when no true interaction exists). Will we accidentally get a significant interaction effect? How often? Does it matter how correlated the predictors are?</p>
<p>To begin, when running a simulation, we generally need a few pieces of information: the different correlations we want to test, the number of samples we want (often, people just choose 1,000), the number of cases per sample, and the number of total cases we’ll need overall. We’ll put these together ahead of time so they are easily available later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">obs_per_sample &lt;-<span class="st"> </span><span class="dv">100</span>
samps_per_cor &lt;-<span class="st"> </span><span class="dv">1000</span>
cor_levels &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> .<span class="dv">80</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)
total_obs &lt;-<span class="st"> </span><span class="kw">length</span>(cor_levels)<span class="op">*</span>samps_per_cor<span class="op">*</span>obs_per_sample</code></pre></div>
<p>To create correlated variables, we will need the <code>mvtnorm</code> package, which can create multivariate normal predictors for us. All we need to do is make the covariance matrix it wants to sample from. Because we are going to be doing this once for each correlation level, we’ll wrap it in a function called <code>gen_sample()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(mvtnorm)

gen_sample &lt;-<span class="st"> </span><span class="cf">function</span>(n, cor_level){
  cov_matrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">c</span>(<span class="dv">1</span>, cor_level, cor_level, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">2</span>)
  
  <span class="kw">rmvnorm</span>(n, <span class="dt">sigma =</span> cov_matrix) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;z&#39;</span>))
}

<span class="co"># a preview</span>
x &lt;-<span class="st"> </span><span class="kw">gen_sample</span>(<span class="dt">n =</span> <span class="dv">1000</span>, <span class="dt">cor_level =</span> .<span class="dv">30</span>)

<span class="kw">head</span>(x)</code></pre></div>
<pre><code>##            x          z
## 1  0.9147473 -0.9707036
## 2 -1.1417592 -0.1430907
## 3  1.0704854  0.2567575
## 4  1.0015961  0.9372988
## 5  0.9864337  0.7464072
## 6 -1.5673610 -0.1426067</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(x)</code></pre></div>
<pre><code>##           x         z
## x 1.0000000 0.2866281
## z 0.2866281 1.0000000</code></pre>
<p>Now that we have our predictors, we’ll need a place to put them. The <code>expand.grid()</code> function is especially useful here. I creates a dataframe out of the vectors we give it, but with every possible combination of every vector element. See here…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">r =</span> cor_levels, <span class="dt">samp =</span> <span class="dv">1</span><span class="op">:</span>samps_per_cor, <span class="dt">obs =</span> <span class="dv">1</span><span class="op">:</span>obs_per_sample)

<span class="kw">head</span>(df, <span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
<pre><code>##      r samp obs
## 1  0.0    1   1
## 2  0.2    1   1
## 3  0.4    1   1
## 4  0.6    1   1
## 5  0.8    1   1
## 6  0.0    2   1
## 7  0.2    2   1
## 8  0.4    2   1
## 9  0.6    2   1
## 10 0.8    2   1</code></pre>
<p>Note that the order you enter your vectors will change the ordering of the elements. Because we will be entering our predictors blocked by correlation, we’ll want to sort by correlation to make sure they go to the right place later on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(r, samp, obs)

<span class="kw">head</span>(df, <span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
<pre><code>##    r samp obs
## 1  0    1   1
## 2  0    1   2
## 3  0    1   3
## 4  0    1   4
## 5  0    1   5
## 6  0    1   6
## 7  0    1   7
## 8  0    1   8
## 9  0    1   9
## 10 0    1  10</code></pre>
<p>Now, let’s use the <code>map()</code> function to generate correlated predictors, with varying levels of correlation. We’ll bind the results, then store the result in two new columns in our dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df[, <span class="kw">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;z&#39;</span>)] &lt;-<span class="st"> </span><span class="kw">map</span>(cor_levels, <span class="op">~</span><span class="st"> </span><span class="kw">gen_sample</span>(samps_per_cor<span class="op">*</span>obs_per_sample, .x)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_rows</span>()

<span class="kw">head</span>(df)</code></pre></div>
<pre><code>##   r samp obs           x          z
## 1 0    1   1  2.36393421 -0.2187102
## 2 0    1   2 -0.90268064 -0.7749229
## 3 0    1   3 -0.09644070  2.0483899
## 4 0    1   4  0.25223212  2.3856130
## 5 0    1   5 -0.66729581 -0.9352575
## 6 0    1   6  0.02098636 -0.1190282</code></pre>
<p>With out predictors, let’s make some variables, including out outcome Y.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">x_sq =</span> x<span class="op">^</span><span class="dv">2</span>,
    <span class="dt">z_sq =</span> z<span class="op">^</span><span class="dv">2</span>,
    <span class="dt">int =</span> x<span class="op">*</span>z,
    <span class="dt">y =</span> <span class="dv">2</span><span class="op">*</span>x_sq <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">n</span>()))</code></pre></div>
<p>Now, we’re ready to collect some results. We’ll grab two sets: one where we run a regression including an interaction, but no quadratic terms, then another where we run a regression with both an interaction and quadratic terms. This often takes a while…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">int_only_results &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(r, samp) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>(broom<span class="op">::</span><span class="kw">tidy</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z <span class="op">+</span><span class="st"> </span>int, <span class="dt">data =</span> .))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &#39;int&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(r) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">false_pos =</span> <span class="kw">sum</span>(p.value <span class="op">&lt;</span><span class="st"> </span>.<span class="dv">05</span>)<span class="op">/</span><span class="kw">n</span>())</code></pre></div>
<p>Still taking a while…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">int_and_quad_results &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(r, samp) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>(broom<span class="op">::</span><span class="kw">tidy</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>z <span class="op">+</span><span class="st"> </span>int <span class="op">+</span><span class="st"> </span>x_sq <span class="op">+</span><span class="st"> </span>z_sq, <span class="dt">data =</span> .))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(term <span class="op">==</span><span class="st"> &#39;int&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(r) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">false_pos =</span> <span class="kw">sum</span>(p.value <span class="op">&lt;</span><span class="st"> </span>.<span class="dv">05</span>)<span class="op">/</span><span class="kw">n</span>())</code></pre></div>
<p>Now let’s compare results!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bind_rows</span>(int_only_results, int_and_quad_results, <span class="dt">.id =</span> <span class="st">&#39;model&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">ifelse</span>(model <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&#39;int_only&#39;</span>, <span class="st">&#39;quads_too&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(model, false_pos)</code></pre></div>
<pre><code>## # A tibble: 5 x 3
##       r int_only quads_too
##   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1   0      0.299     0.037
## 2   0.2    0.626     0.05 
## 3   0.4    0.961     0.042
## 4   0.6    0.999     0.057
## 5   0.8    1         0.045</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functionals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="strings-and-text.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
